var tbf_s=new Object;tbf_s.d_header="mb-3 text-center",tbf_s.d_fields=new Object,tbf_s.d_fields.offset="py-1";var tbf_class=new Array,tbf_object_parent=0;function get_values(){tbf_s.p_number=$(".tbf_object").length,get_edition(0),get_second_attrib(0),$(".tbf_object").each(function(){var t=new Object;$(this).data("category")&&(t.category=$(this).data("category")),t.title=$(this).data("title"),$(this).data("description")&&(t.descr=$(this).data("description"));for(var e=new Array,r=$(this).find("tbody > tr").length,_=$(this).find("tbody > tr:first-child td").length-1,o=$(this).find("table *").is("thead")?0:1;o<r;o++)for(var a=0;a<_;a++){var i=new Object;i.edition=$(this).find("table tr").eq(0).find("td").eq(a+1).text().trim().replace(/ /g,"_"),i.attrib=$(this).find("table tbody tr").eq(o).find("td:first-child").text().trim(),i.price=$(this).find("table tbody tr").eq(o).find("td").eq(a+1).html().trim(),console.log(i.price),e.push(i)}t.table=e,tbf_class.push(t)}),console.log(tbf_class)}function get_edition(t){tbf_s.p_edition.splice(0,tbf_s.p_edition.length),$(".tbf_object").eq(t).find("table tr").eq(0).find("td").each(function(){tbf_s.p_edition.push($(this).text().trim())}),tbf_s.p_edition.splice(0,1)}function get_second_attrib(t){tbf_s.p_second_parametr.splice(0,tbf_s.p_second_parametr.length),$(".tbf_object").eq(t).find("table tr").each(function(){tbf_s.p_second_parametr.push($(this).find("td:first-child").text().trim())}),tbf_s.p_second_parametr.splice(0,1)}function write_on_page(){$(".tbf_filter").prepend('<h4 class="h3 '+tbf_s.d_header+'">'+tbf_s.t_header+"</h4>"),$(".tbf_filter").append('<div class="tbf_filter_form col-12 pb-3"></div><p class="text-center">Цена: <b class="text-primary"><span id="tbf_result"></span> руб.</b></p>'),0!=tbf_s.tr_description&&$(".tbf_filter").append('<p class="text-center"><small id="tbf_result_description"></small></p>'),output_categories(),output_variants(),output_edition(),output_second_parametr()}function output_categories(t){if(tbf_s.tr_categories){$(".tbf_filter_form").append('<div class="row"><div class="btn-group col px-0 mb-3 tbf_property tbf_property_category" data-toggle="buttons"></div></div>');for(var e=0;e<tbf_s.p_categories.length;e++)0==e?$(".tbf_property_category").append('<label class="btn btn-primary col-form-label active"><input class="tbf_property_category_input" type="radio" value="'+tbf_s.p_categories[e]+'" name="price_category" id="option'+e+'" autocomplete="off" checked>'+tbf_s.p_categories[e]+"</label>"):$(".tbf_property_category").append('<label class="btn btn-primary col-form-label"><input class="tbf_property_category_input" type="radio" value="'+tbf_s.p_categories[e]+'" name="price_category" id="option'+e+'" autocomplete="off">'+tbf_s.p_categories[e]+"</label>")}}function output_variants(t){if(1!=tbf_s.p_number){$(".tbf_filter_form").append('<div class="row form-group '+tbf_s.d_fields.offset+'"><select class="tbf_property tbf_property_type col-12 form-control"></select></div>');for(var e=0;e<tbf_class.length;e++)tbf_s.tr_categories?tbf_class[e].category==$(".tbf_property_category label.active input").val()&&$(".tbf_property_type").append("<option value='"+e+"' data-category='"+tbf_class[e].category+"'>"+tbf_class[e].title+"</option>"):$(".tbf_property_type").append("<option value='"+e+"'>"+tbf_class[e].title+"</option>")}}function output_edition(t){"reload"==t?$(".tbf_filter_form").find(".tbf_property_edition option").remove():$(".tbf_filter_form").append('<div class="row form-group '+tbf_s.d_fields.offset+'"><div class="col-5 text-right col-form-label">'+tbf_s.t_edition_title+'</div><select class="tbf_property tbf_property_edition col-7 form-control"></select></div>');for(var e=0;e<tbf_s.p_edition.length;e++)$(".tbf_property_edition").append("<option value="+tbf_s.p_edition[e].replace(/ /g,"_")+">"+tbf_s.p_edition[e]+"</option>")}function output_second_parametr(t){if($(".tbf_property_attrib").parent(".row").remove(),"reload"==t&&$(".tbf_filter_form").find(".tbf_property_attrib").find("option").remove(),1!=tbf_s.p_second_parametr.length){$(".tbf_filter_form").append('<div class="row form-group '+tbf_s.d_fields.offset+'"><div class="col-5 text-right col-form-label">'+tbf_s.t_second_parametr_title+'</div><select class="tbf_property tbf_property_attrib col-7 form-control"></select></div>');for(var e=0;e<tbf_s.p_second_parametr.length;e++)$(".tbf_property_attrib").append("<option value="+tbf_s.p_second_parametr[e].replace(/ /g,"_")+">"+tbf_s.p_second_parametr[e]+"</option>")}}function category_output(){$(".tbf_property_type option").remove();for(var t=0;t<tbf_class.length;t++)tbf_class[t].category==$(".tbf_property_category .active input").val()&&$(".tbf_property_type").append("<option value='"+t+"' data-category='"+tbf_class[t].category+"'>"+tbf_class[t].title+"</option>");tbf_s.tr_categories_click_reload,price_output()}function price_output(){var t=0,e=0,r=0;e=$("*").is(".tbf_property_type")?$(".tbf_property_type").val():tbf_object_parent;var _=$(".tbf_property_edition").val();$("*").is(".tbf_property_attrib")&&(r=$(".tbf_property_attrib").val().replace(/ /g,"_"),t=1);for(var o=0;o<tbf_class[e].table.length;o++)0===t?tbf_class[e].table[o].edition==_&&(tbf_s.p_result=tbf_class[e].table[o].price):1===t&&tbf_class[e].table[o].edition==_&&tbf_class[e].table[o].attrib.replace(/ /g,"_")==r&&(tbf_s.p_result=tbf_class[e].table[o].price);$("#tbf_result").html(tbf_s.p_result),$("#tbf_result_description").html(tbf_class[e].descr)}$(document).ready(function(){0<$(".tbf_object").length&&(tbf_s.p_multiplier=parseFloat($("#coef").text()),tbf_s.p_result=0,tbf_s.p_number=$(".tbf_object").length,tbf_s.p_categories=$(".tbf_filter").data("property-categories"),tbf_s.p_edition=new Array,tbf_s.p_second_parametr=new Array,$(".tbf_filter").data("property-categories")&&(tbf_s.tr_categories=!0),tbf_s.tr_description=$(".tbf_filter").data("trigger-description"),tbf_s.tr_categories_click_reload=$(".tbf_filter").data("trigger-categories-click-reload"),tbf_s.t_header="Расчет стоимости",$(".tbf_filter").data("title-header")&&(tbf_s.t_header=$(".tbf_filter").data("title-header")),tbf_s.t_edition_title="Тираж",$(".tbf_filter").data("title-edition-parametr")&&(tbf_s.t_edition_title=$(".tbf_filter").data("title-edition-parametr")),tbf_s.t_second_parametr_title=$(".tbf_object").eq(0).find("table tr").eq(0).find("td").eq(0).text(),$(".tbf_filter").data("title-additional-parametr")&&(tbf_s.t_second_parametr_title=$(".tbf_filter").data("title-additional-parametr")),get_values(),write_on_page(),price_output()),$(document).on("change",".tbf_property",function(){price_output()}),$(".tbf_property_type").on("change",function(){if(tbf_class[0].table[0].edition!=tbf_class[1].table[0].edition){var t=$(".tbf_property_type").val();get_edition(t),get_second_attrib(t),output_edition("reload"),output_second_parametr()}price_output()}),$(".tbf_property_category label").click(function(){setTimeout(function(){category_output()},10)})});